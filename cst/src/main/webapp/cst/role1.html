<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta charset="utf-8"/>
    <title>角色管理界面</title>

    <meta name="description" content="overview &amp; stats"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
    <!-- page specific plugin styles -->
    <link rel="stylesheet" href="../assets/css/jquery-ui.min.css"/>
    <link rel="stylesheet" href="../assets/css/datepicker.min.css"/>
    <link rel="stylesheet" href="../assets/css/ui.jqgrid.min.css"/>
    <!-- bootstrap & fontawesome -->
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="../assets/font-awesome/4.2.0/css/font-awesome.min.css"/>
    <!-- page specific plugin styles -->
    <!-- text fonts -->
    <link rel="stylesheet" href="../assets/fonts/fonts.googleapis.com.css"/>

    <!-- ace styles -->
    <link rel="stylesheet" href="../assets/css/ace.min.css" class="ace-main-stylesheet" id="main-ace-style"/>

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="../assets/css/ace-part2.min.css" class="ace-main-stylesheet"/>
    <![endif]-->

    <!--[if lte IE 9]>
    <link rel="stylesheet" href="../assets/css/ace-ie.min.css"/>
    <![endif]-->

    <!-- inline styles related to this page -->


</head>
<body class="no-skip">

<div class="page-content">
    <div class="page-header">
        <h1>
            角色信息
            <small><i class="ace-icon fa fa-angle-double-right"></i>
            </small>
        </h1>
    </div>


    <!-- /.page-header -->
    <div class="row">
        <div class="col-xs-12">
            <!--工具栏 -->
            <div class="tool_bg">
                <button class="btn btn-yellow" data-toggle="modal" data-target="#add-modal">
                    <i class="ace-icon fa fa-plus-circle"></i> 添加
                </button>

            </div>
            <!--</br>-->
            <div style="padding-top: 5px">
                <table class="table" id="role_table">
                </table>
                <div id="common_role_pager"></div>
            </div>
        </div>
    </div>



    <!--新增角色界面-->
    <div tabindex="-1" class="modal fade in" id="add-modal" aria-hidden="false" style="padding-right: 17px; display:none">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="close" aria-hidden="true" type="button" data-dismiss="modal">×</button>
                    <h3 class="smaller lighter blue no-margin">新增窗口</h3>
                </div>

                <div class="modal-body">
                    <div class="row">
                        <div class="col-xs-12">
                            <!--<form class="form-horizontal" style="margin: 0px">-->
                                <!--<table style="width: 100%;margin-left: 15%" cellpadding="30" cellspacing="30">-->
                                    <!--<tr>-->
                                        <!--<td align="right">-->
                                            <!--<label class="control-label" for="add_rolename">角色名称:</label>-->
                                        <!--</td>-->
                                        <!--<td>-->
                                            <!--&lt;!&ndash;<select  id="add_rolename" name="rolename" style="width:168px">&ndash;&gt;-->
                                                <!--&lt;!&ndash;<option value="普通用户">普通用户</option>&ndash;&gt;-->
                                                <!--&lt;!&ndash;<option value="超级用户">超级用户</option>&ndash;&gt;-->
                                            <!--&lt;!&ndash;</select>&ndash;&gt;-->
                                            <!--<input id="add_rolename" name="rolename" type="text" style="width:168px" >-->
                                        <!--</td>-->
                                    <!--</tr>-->
                                    <!--<tr>-->
                                        <!--<td align="right">-->
                                            <!--<label class="control-label" for="add_description">角色说明:</label>-->
                                        <!--</td>-->
                                        <!--<td>-->
                                            <!--<input id="add_description" name="description" type="text" style="width:168px" >-->
                                        <!--</td>-->
                                    <!--</tr>-->
                                    <!--<tr>-->
                                        <!--<td align="right">-->
                                            <!--<label class="control-label" >权限:</label>-->
                                        <!--</td>-->
                                        <!--&lt;!&ndash;<td >&ndash;&gt;-->
                                        <!--&lt;!&ndash;<div class="checkbox">&ndash;&gt;-->
                                        <!--&lt;!&ndash;<label>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<input name="pname" type="checkbox" class="ace" value="用户管理"/>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<span class="lbl"> 用户管理</span>&ndash;&gt;-->
                                        <!--&lt;!&ndash;</label>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<label>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<input name="pname" type="checkbox" class="ace" value="角色管理"/>&ndash;&gt;-->
                                        <!--&lt;!&ndash;<span class="lbl"> 角色管理</span>&ndash;&gt;-->
                                        <!--&lt;!&ndash;</label>&ndash;&gt;-->
                                        <!--&lt;!&ndash;</div>&ndash;&gt;-->
                                        <!--&lt;!&ndash;</td>&ndash;&gt;-->
                                    <!--</tr>-->

                                <!--</table>-->

                            <!--</form>-->
                            <form class="form-horizontal" >
                                <div style="margin-left: 100px">
                                    <div class="form-group">
                                        <label for="add_rolename" class="col-sm-2 control-label">角色名称</label>
                                        <div class="col-sm-6">
                                            <input type="text" class="form-control" id="add_rolename"  name="rolename" placeholder="请输入角色名称">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="add_description" class="col-sm-2 control-label">角色说明</label>
                                        <div class="col-sm-6">
                                            <input type="text" class="form-control" id="add_description" name="description" placeholder="请输入角色说明">
                                        </div>
                                    </div>

                                    <div>
                                        <div class="row">
                                            <div class="col-sm-6">
                                                <span class="bigger-110">Multiple</span>
                                            </div><!-- /.span -->

                                            <div class="col-sm-6">
																	<span class="pull-right inline">
																		<span class="grey">style:</span>

																		<span class="btn-toolbar inline middle no-margin">
																			<span id="chosen-multiple-style" data-toggle="buttons" class="btn-group no-margin">
																				<label class="btn btn-xs btn-yellow active">
																					1
																					<input type="radio" value="1" />
																				</label>

																				<label class="btn btn-xs btn-yellow">
																					2
																					<input type="radio" value="2" />
																				</label>
																			</span>
																		</span>
																	</span>
                                            </div><!-- /.span -->
                                        </div>

                                        <div class="space-2"></div>

                                        <select multiple="" class="chosen-select" id="form-field-select-4" data-placeholder="Choose a State...">
                                            <option value="AL">Alabama</option>
                                            <option value="AK">Alaska</option>
                                            <option value="AZ">Arizona</option>
                                            <option value="AR">Arkansas</option>
                                            <option value="CA">California</option>
                                            <option value="CO">Colorado</option>
                                            <option value="CT">Connecticut</option>
                                            <option value="DE">Delaware</option>
                                            <option value="FL">Florida</option>
                                            <option value="GA">Georgia</option>
                                            <option value="HI">Hawaii</option>
                                            <option value="ID">Idaho</option>
                                            <option value="IL">Illinois</option>
                                            <option value="IN">Indiana</option>
                                            <option value="IA">Iowa</option>
                                            <option value="KS">Kansas</option>
                                            <option value="KY">Kentucky</option>
                                            <option value="LA">Louisiana</option>
                                            <option value="ME">Maine</option>
                                            <option value="MD">Maryland</option>
                                            <option value="MA">Massachusetts</option>
                                            <option value="MI">Michigan</option>
                                            <option value="MN">Minnesota</option>
                                            <option value="MS">Mississippi</option>
                                            <option value="MO">Missouri</option>
                                            <option value="MT">Montana</option>
                                            <option value="NE">Nebraska</option>
                                            <option value="NV">Nevada</option>
                                            <option value="NH">New Hampshire</option>
                                            <option value="NJ">New Jersey</option>
                                            <option value="NM">New Mexico</option>
                                            <option value="NY">New York</option>
                                            <option value="NC">North Carolina</option>
                                            <option value="ND">North Dakota</option>
                                            <option value="OH">Ohio</option>
                                            <option value="OK">Oklahoma</option>
                                            <option value="OR">Oregon</option>
                                            <option value="PA">Pennsylvania</option>
                                            <option value="RI">Rhode Island</option>
                                            <option value="SC">South Carolina</option>
                                            <option value="SD">South Dakota</option>
                                            <option value="TN">Tennessee</option>
                                            <option value="TX">Texas</option>
                                            <option value="UT">Utah</option>
                                            <option value="VT">Vermont</option>
                                            <option value="VA">Virginia</option>
                                            <option value="WA">Washington</option>
                                            <option value="WV">West Virginia</option>
                                            <option value="WI">Wisconsin</option>
                                            <option value="WY">Wyoming</option>
                                        </select>
                                    </div>
                                </div>

                            </form>

                        </div>

                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-lg btn-danger pull-left" onclick="closeAddWin()">
                        <i class="ace-icon fa  fa-undo"></i> 取消
                    </button>
                    <button class="btn btn-lg btn-success" type="button" onclick="addFn()">
                        <i class="ace-icon fa fa-check"></i> 提交
                    </button>
                </div>
            </div>
        </div>
    </div>

</div>


<!--JS-->

<!-- ace settings handler -->
<script src="../assets/js/ace-extra.min.js"></script>

<!-- HTML5shiv and Respond.js for IE8 to support HTML5 elements and media queries -->

<!--[if lte IE 8]>
<script src="../assets/js/html5shiv.min.js"></script>
<script src="../assets/js/respond.min.js"></script>
<![endif]-->

<!--[if !IE]> -->
<script src="../assets/js/jquery.2.1.1.min.js"></script>

<!-- <![endif]-->

<!--[if IE]>
<script src="../assets/js/jquery.1.11.1.min.js"></script>
<![endif]-->

<!--[if !IE]> -->
<script type="text/javascript">
    window.jQuery
    || document.write("<script src='assets/js/jquery.min.js'>"
            + "<" + "/script>");
</script>

<!-- <![endif]-->

<!--[if IE]>
<script type="text/javascript">
    window.jQuery || document.write("<script src='assets/js/jquery1x.min.js'>" + "<" + "/script>");
</script>
<![endif]-->

<!--表单验证-->
<!--<link rel="stylesheet" href="../assets/js/vendor/bootstrap/css/bootstrap.css"/>-->
<!--<link rel="stylesheet" href="../assets/js/dist/css/bootstrapValidator.css"/>-->

<script src="../assets/js/bootstrap.min.js"></script>
<!-- page specific plugin scripts -->
<script src="../assets/js/bootstrap-datepicker.min.js"></script>
<script src="../assets/js/jquery.jqGrid.min.js"></script>
<script src="../assets/js/grid.locale-en.js"></script>


<script src="../assets/js/bootstrap-datepicker.min.js"></script>
<script src="../assets/js/bootbox.min.js"></script>


<!--[if lte IE 8]>
<script src="../assets/js/excanvas.min.js"></script>
<![endif]-->

<!-- ace scripts -->
<script src="../assets/js/ace-elements.min.js"></script>
<script src="../assets/js/ace.min.js"></script>
<script src="../js/common/bootstrp-tab.js"></script>
<script type="text/javascript" src="../js/commonJs/common.js"></script>
<script type="text/javascript" src="../js/commonJs/appCommon.js"></script>
<script type="text/javascript" src="../js/commonJs/commonUtils.js"></script>

<!--表单验证-->
<script type="text/javascript" src="../assets/js/dist/js/bootstrapValidator.js"></script>

<script>


    $(document).ready(function () {
        //查询角色
        doSearch();
    });

    /*查询所有角色*/
    function doSearch() {
        var selectAllUrl_ = "/" + PROJECT_NAME + "/Role/selectAllRole.do";

        ajaxFunction(
                selectAllUrl_,
                null,
                function (result) {
                    if (result.success) {
                        $("#role_table").GridUnload();
                        $("#role_table").jqGrid(
                                {
                                    data: result.data,
                                    datatype: "local",
                                    height: 250,
                                    colModel: [
                                        {
                                            "name": "roleId",
                                            "label": "roleId",
                                            "hidden": true
                                        },
                                        {
                                            "name": "description",
                                            "label": "角色说明"
                                        },
                                        {
                                            "name": "权限集合",
                                            "label": "权限",
                                            "formatter": getPermission
                                        },
                                        {
                                            "name" : "fnDiv",
                                            "label" : "功能",
                                            "formatter" : function(
                                                    value, options,
                                                    rowData) {
                                                return "<div style='margin-left: 8px;'>"
                                                        + "<div  class='ui-pg-div ui-inline-edit'  style='float: left; cursor: pointer;'  onclick='openUpdateWin("
                                                        + JSON.stringify(rowData)
                                                        + ")'; ><span class='ui-icon ui-icon-pencil'></span></div>"
                                                        + "<div  class='ui-pg-div ui-inline-del' style='margin-left: 5px; float: left;'  onclick=\"delConfirm('"
                                                        + rowData.id
                                                        + "')\" data-original-title='Delete'><span class='ui-icon ui-icon-trash'></span></div></div>";

                                            }
                                        }
                                        ],
                                    viewrecords: true,
                                    rowNum: 10,
                                    rowList: [10, 20, 30],
                                    pager: "#common_role_pager",
                                    altRows: true,
                                    multiselect: false,
                                    multiboxonly: true,
                                    rownumbers: true,
                                    autowidth: true,
                                    loadComplete: function () {
                                        var table = this;
                                        setTimeout(function () {
                                            // styleCheckbox(table);
                                            // updateActionIcons(table);
                                            updatePagerIcons(table);
                                            // enableTooltips(table);
                                        }, 0);
                                    }
                                });
                    }

                });
    }




    function getPermission(value, options,rowData) {

        var result = selectPermissionByRoleId(rowData);
//        var prefixString = "<div class='checkbox' style='margin-left: 8px'>";
//        var suffixString = "</div>";
        var middleString = "";
        for(var i in result.data){
            middleString += "<label><input name='form-field-checkbox' type='checkbox' class='ace' checked disabled/> <span class='lbl'>"
                        + result.data[i].permissionName
                        + "</span>";
        }
        return middleString;

    }

    /*通过roleId来获取权限集合*/
    function selectPermissionByRoleId(rowData) {
        var permissionResult = {};
        var selectPermissionURL_ = "/" + PROJECT_NAME + "/Permission/selectPermissionByRoleId.do";
        var params = {roleId: rowData.roleId};
        ajaxFunction(selectPermissionURL_, params, function (result) {
                    if (result.success) {
                        permissionResult = $.extend({}, result);
                    }
                },false
        );
        return permissionResult;
    }


</script>
</body>

</html>
